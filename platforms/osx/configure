#!/usr/bin/env bash

if [[ $# -lt 1 ]]; then 
  BUILD_ARCH="i386"
else
  BUILD_ARCH="$1"
fi

echo "will built for $BUILD_ARCH"

cd ../..

cd vtk
cmake -DCMAKE_OSX_ARCHITECTURES=$BUILD_ARCH -DBUILD_TESTING:BOOL=OFF -DBUILD_SHARED_LIBS:BOOL=OFF -DCMAKE_BUILD_TYPE:BOOL=Release .
make
cd ..

cd platforms/osx
mkdir -p build
cd build
cmake -DCMAKE_OSX_ARCHITECTURES=$BUILD_ARCH -DBUILD_PERF_TESTS=FALSE -DBUILD_TESTS:BOOL=FALSE -DBUILD_DOCS:BOOL=FALSE -DBUILD_JPEG:BOOL=TRUE -DBUILD_PNG:BOOL=TRUE -DBUILD_TIFF:BOOL=TRUE -DWITH_WEBP:BOOL=OFF -DWITH_IPP:BOOL=OFF -DBUILD_opencv_ts:BOOL=OFF -DBUILD_opencv_apps:BOOL=OFF -DWITH_CUDA:BOOL=OFF -DOPENCV_EXTRA_MODULES_PATH=../../../opencv_contrib/modules -DBUILD_SHARED_LIBS:BOOL=OFF -DVTK_DIR:STRING=$PWD/vtk -DWITH_LAPACK:BOOL=OFF ../../../
make

cd ..